{% extends 'base.html' %}
{% block title %}{{ construct.title_text }}{% endblock %}
{% block content %}
{% load static %}
<script src="{% static 'list/detail.js' %}">
</script>
<link rel="stylesheet" href="{% static 'list/style.css' %}">

<h1>{{ construct.title_text }}</h1>
<br>
{% if 'list.change_construct' in perms %}
    &larr; <a href="{% url 'list:detail' construct.id %}">back to the full view</a>
    <br>
    <br>
{% endif %}

<table id='choices_head'>
<tbody>
<tr>
    <td><b>Address:</b></td>
    <td>{{ construct.address_text }}</td>
    <td></td>
    <td></td>
    <td></td>
</tr>
<tr>
    <td><b>Email:</b></td>
    <td>{{ construct.email_text }}</td>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
    <td><b>Total:</b></td>
    <td id='project_total'>&#163; {{ construct_total }}</td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
</tr>
<tr>
    <td><b>Phone:</b></td>
    <td>{{ construct.phone_text }}</td>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
    <td><b>+ {{ construct.company_profit_percent_num }}% profit:</b></td>
    <td id='project_total_profit'>&#163; {{ total_and_profit|floatformat:2 }}</td>
    <td><b>Progress (incl. profit):</b></td>
    <td id='progress_cost'>&#163; updating...</td>
</tr>
<tr>
    <td><b>Owner:</b></td>
    <td>{{ construct.owner_name_text }}</td>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
    <td><b>VAT:</b></td>
    <td id='project_vat'>{{ construct.vat_percent_num }}%</td>
    <td rowspan='2'><b>Progress<br> + VAT:</b></td>
    <td id='progress_vat' rowspan='2'>&#163; updating...</td>
</tr>
<tr>
    <td><div id='profit_percent' style='display:none'>{{ construct.company_profit_percent_num }}</div></td>
    <td></td>
    <td></td>
    <td><b>Total + Profit + VAT:</b></td>
    <td id='project_total_profit_vat'>&#163; {{ total_profit_vat }}</td>
</tr>
<tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td><b>Paid:</b></td>
    <td id='paid'>&#163; {{ construct_paid }}</td>
</tr>
<tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td><b>To be paid:</b></td>
    <td id='to_be_paid'>&#163; updating...</td>
</tr>
</tbody>
</table>

<br><br>
<div id='project_last_save_date'>
<b>Date modified:</b>&nbsp;{{ construct.last_save_date }}
</div>
<br>
<form id='choices_form' action="{% url 'list:client' construct.id %}" method='POST'>
{% csrf_token %}
<table id='choices'>
<thead><tr>
    <td></td>
    <th class="name_cell">Task name</th>
    <th>Unit price</th>
    <th>Quantity</th>
    <th><!--Units--></th>
    <th>Total price</th>
    <th style='display:none'></th>
    <th>Date start</th>
    <th>Planned days</th>
    <th>Progress</th>
    <th></th>
</tr></thead>
<tbody>
{% for items in ch_list %}
    {% if items.type == 'Choice' %}
        <tr id='tr_{{ items.choice.id }}' class='{{ items.type }}'>
    {% else %}
        <tr id='hd_{{ items.choice.id }}' class='{{ items.type }}'>
    {% endif %}
        <td align='right'>{{ forloop.counter }}</td>
    {% if items.type == 'Choice' %}
        <td>{{ items.choice.name_txt }}</td>
        <td align='right'>&#163;{{ items.choice.price_num }}</td>
        <td align='right'>{{ items.choice.quantity_num }}</td>
        <td align='left'>{{ items.choice.units_of_measure_text }}</td>
        <td align='right' class='choice_total_price'>&#163;{{ items.choice_total_price|floatformat:2 }}</td>
        <td style='display:none'></td>
        <td>{{ items.choice.plan_start_date }}</td>
        <td align='center'>{{ items.choice.plan_days_num }}</td>
        <td class="progress-cell">
            <div class='project-progress' style='width: {{ items.choice.progress_percent_num }}%'>
                <div class='choice_progress_percent'>
                    {{ items.choice.progress_percent_num|floatformat:2 }}&nbsp;%
                </div>
            </div>
        </td>
        <td>
            <div class='notes-form'>
                <form></form>
                <form action="#">
                    <button type="button" onclick="hideNotesForm(this)">Hide Notes</button><br><br>
                    {{ items.choice.name_txt }}<br><br>
                    <p>Constructive notes</p>
                    <textarea class='constructive_notes' name='con-notes' rows='10' cols='45'>
{{ items.choice.constructive_notes }}</textarea><br><br>
                    <p>Client notes</p>
                    <textarea class='client_notes' name='cli-notes' rows='10' cols='45'>
{{ items.choice.client_notes }}</textarea>
                </form>
            </div>
            <div class='notes-link'>
                <a href='#' title="<<<Constructive>>>: &quot;{{ items.choice.constructive_notes }}&quot;
<<<Client>>>: &quot;{{ items.choice.client_notes}}&quot;"
                {% if items.choice.constructive_notes|length > 2 or items.choice.client_notes|length > 2 %}
                    class="link-txt" onclick="return showNotesForm(this);">NOTES</a>
                {% else %}
                    class="link-txt" onclick="return showNotesForm(this);">notes</a>
                {% endif %}
            </div>
            <div class='constructive-notes'>{{ items.choice.constructive_notes }}</div>
            <div class='client-notes'>{{ items.choice.client_notes}}</div>
        </td>
    {% else %}
        <td class='td_header_2' colspan='5'>{{ items.choice.name_txt }}</td>
        <td></td>
        <td></td>
        <td></td>
        <td style='display:none'></td>
        <td></td>
    {% endif %}
        </tr>
{% endfor %}
</tbody>
</table>
<script>setForm();</script>
<br>
<table id='choices_footer'>
<tr>
    <td>
        <input type='hidden' id='json_input' name='json_value' value=''>
    </td>
    <td><input type='submit' value='Save modifications'></td>
</tr>
</table>
</form>
<div style='display:none' id='active_row'>-1</div>
<div style='display:none' id='modified'>no</div>
<script>updateHeaders();</script>
{% endblock %}
