{% extends 'base.html' %}
{% block title %}Project list{% endblock %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'list/style.css' %}">
<h1>Projects</h1>
<a href="{% url 'admin:list_construct_add' %}">add a project</a>
&nbsp;&nbsp;
<a href="{% url 'admin:index' %}">admin home page</a>
<br><br>
<b>Categories:</b>&nbsp;
<a href="{% url 'list:index' %}">all</a>&nbsp;
{% if active_done_inds %}
<span style="background-color: lightblue; padding: 2px; border-radius: 3px">
    <a href="?category={{ active_done_inds }}">Active+Done</a>
</span>&nbsp;
{% endif %}
{% for ctg in categories %}
    <span style="background-color: {{ ctg.color }}; padding: 2px; border-radius: 3px">
        <a href="?category={{ ctg.id }}">{{ ctg.name }}</a>
    </span>&nbsp;
{% endfor %}
{% if active_construct_list %}
<table id='construct_list'>
    <thead>
        <th>Project name</th>
        <th>Progress</th>
        <th>Chart</th>
        <th>Foreman</th>
        <th title="Full cost of the project with Company Profit and VAT.">Cost<sup>?</sup></th>
        <th style="display: none">Main<br>cost</th>
        <th>Paid<br>deposit</th>
        <th title="Will be equal to Cost, when the project is 100% done.">Full<sup>?</sup><br>progress</th>
        <th style="display: none" title="Main contract progress + additional works progress">Deposit<sup>?</sup><br>aware<br>progress</th>
        <th title="Current income according to incoming transactions including the deposit.">Income<sup>?</sup></th>
        <th title="Current outcome according to outgoing transactions.">Outcome<sup>?</sup> =</th>
        <th>Expenses +</th>
        <th>Salaries<br>paid</th>
        <th>Company<br>Profit</th>
        <th title="(Income &minus; VAT) * 0.13">Owner<sup>?</sup><br>Profit</th>
        <th title="Income &minus; VAT &minus; Owner Profit &minus; Outcome.">Salaries<sup>?</sup><br>Part</th>
        <th title="Main contract progress (deposit aware) + side works progress - (income - deposit). Invoice the client, if this is positive.">Left<sup>?</sup><br>to pay</th>
        <th title="Received invoices, which need to be payed. (Outcome.)">Invoices<sup>?</sup><br>to Pay (debt)</th>
        <th title="Sent invoices, which are not payed yet. (Income.)">Requested<sup>?</sup><br>Payments</th>
    </thead>
    <tbody>
    {% for construct in active_construct_list %}
        <tr>
        <td class='construct-title' style="background-color: {{ construct.color }}; border-radius: 7px">
            <a href="{% url 'list:detail' construct.id %}">{{ construct.title_text }}</a>
        </td>
        <td align='left' class='progress-cell'>
            <div class='project-progress' style='width: {{ construct.overall_progress_percent_num }}%'>
                {{ construct.overall_progress_percent_num|floatformat:2 }}&nbsp;%
            </div>
        </td>
        <td>
            <a href="{% url 'list:gantt' construct.id %}">Gantt</a>
        </td>
        <td>
            <a href="?foreman={{ construct.foreman.id }}">
                {{ construct.foreman.username }}
            </a>
        </td>
        <td align ='right'>
            {{ construct.full_cost }}
        </td>
        <td align ='right' style="display: none">{{ construct.main_cost }}</td>
        <td align ='right'>{{ construct.deposit|floatformat:2 }}<br>({{ construct.deposit_percent|floatformat:2 }}%)</td>
        <td align ='right'>
            {{ construct.full_progress_cost }}
        </td>
        <td align ='right' style="display: none">
            {{ construct.no_deposit_progress_cost }} +<br>
            {{ construct.full_side_progress_cost }}
        </td>
        <td align ='right'>
            <a href="{% url 'list:flows' construct.id %}#incoming-transactions">
            {{ construct.round_income }}
            </a>
        </td>
        <td align ='right'>
            <a href="{% url 'list:flows' construct.id %}#outgoing-transactions">
            {{ construct.round_outcome }}
            </a>
        </td>
        <td align ='right'>
            {{ construct.round_expenses }}
        </td>
        <td align ='right'>
            <a href="{% url 'list:flows' construct.id %}#salary-transactions">
            {{ construct.round_salaries }}
            </a>
        </td>
        <td align ='right'>
            {{ construct.company_profit }}<br>
            ({{ construct.company_profit_percent|floatformat:1 }}%)
        </td>
        <td align ='right'>
            {{ construct.owner_profit }}
        </td>
        <td align ='right'>
            {{ construct.salaries_part }}
        </td>
        <td align ='right'>
            {{ construct.left_to_pay }}
        </td>
        <td align ='right'>
            <a href="{% url 'list:invoices' construct.id %}?direction=unpaid">
            {{ construct.invoices_to_pay }}
            </a>
        </td>
        <td align ='right'>
            <a href="{% url 'list:invoices' construct.id %}?direction=unpaid">
            {{ construct.invoices_pending_pay }}
            </a>
        </td>
        </tr>
    {% endfor %}
    {% if total %}
        <tr>
        <td align='right'>
            <b>Total:</b>
        </td>
        <td align='left' class='progress-cell'>
            <div class='project-progress' style='width: {{ total.overall_progress_percent_num }}%'>
                {{ total.overall_progress_percent_num|floatformat:2 }}&nbsp;%
            </div>
        </td>
        <td></td>
        <td></td>
        <td align ='right'>
            <b>{{ total.full_cost }}</b>
        </td>
        <td align ='right'><b>{{ total.deposit }}</b></td>
        <td align ='right'>
            <b>{{ total.full_progress_cost }}</b>
        </td>
        <td align ='right'>
            <b>{{ total.round_income }}</b>
        </td>
        <td align ='right'>
            <b>{{ total.round_outcome }}</b>
            </a>
        </td>
        <td align ='right'>
            <b>{{ total.round_expenses }}</b>
        </td>
        <td align ='right'>
            <b>{{ total.round_salaries }}</b>
        </td>
        <td align ='right'>
            <b>{{ total.company_profit }}</b>
        </td>
        <td align ='right'>
            <b>{{ total.owner_profit }}</b>
        </td>
        <td align ='right'>
            <b>{{ total.salaries_part }}</b>
        </td>
        <td align ='right'>
            <b>{{ total.left_to_pay }}</b>
        </td>
        <td align ='right'>
            <b>{{ total.invoices_to_pay }}</b>
        </td>
        <td align ='right'>
            <b>{{ total.invoices_pending_pay }}</b>
        </td>
        </tr>
    {% endif %}
    </tbody>
</table>

{% else %}
    <p>No projects are available.</p>
{% endif %}
{% endblock %}
